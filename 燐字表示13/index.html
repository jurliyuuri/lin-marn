<head></head>
<body>
<h1>「第13回燐字書き取り」分割</h1>
<p>第13回！</p>
<p>分割した画像？<a href="http://jurliyuuri.com/lin-marn/linzi_image_table_narrow.html">ここ</a>の燐字画像22の列にあるやつで全部だ！jsが書けないのでいつものあれは省略。</p>
<p>元画像は<a href="img1.png">img1</a>と<a href="img2.png">img2</a>で確認。</p>
<h2>1. leastsquare.py</h2>
<p>私(skarsna.meloviliju)もこの作業は初めてなので、j.v.氏に訊きつつ前例と取っ組みあうことにする。</p>
<p>原稿の四隅(1枚目)に位置する4字の（マスの<strong>左上</strong>の）座標をGIMPで取ると、</p>
<pre>
      y1,   y2       s1 s2
左上:   58,   58 --->  0, 0
右上:  921,   58 --->  9, 0
左下:   58, 1314 --->  0,19
右下:  920, 1314 --->  9,19
</pre>
<p>だったので、これをleastsquare.pyのsとyに突っ込んでやると下の理論が動いて必要な行列がでるらしい。科学の力ってすごいね。</p>
<p>うまいパラメータt<sub>10</sub>, t<sub>11</sub>, t<sub>12</sub>, t<sub>20</sub>, t<sub>21</sub>, t<sub>22</sub>を持ってきて、</p>
<img src="matrix.png" width="780"/>
<p>となるようにしてやれば良い。ただしs<sub>0</sub>たちは全部1。</p>
<p>Y ≒ T<sub>1</sub>Sで最小二乗法をやるのでYS<sup>T</sup>=T<sub>1</sub>SS<sup>T</sup>を解けばよく、T<sub>1</sub>=YS<sup>T</sup>(SS<sup>T</sup>)<sup>-1</sup>なのでT<sub>1</sub>は</p>
<pre>
[[ 2.26000000e+02 3.73714286e+02 3.57142857e-01]
[ 4.31750000e+02 -6.42857143e-01 2.75678571e+02]]
</pre>
<p>となるらしい、なるほど。</p>
<p>j.v.氏曰く、行間はこの計算で自動的に算出されるらしいので、次はsplit.pyへ。</p>
<br>
<h2>2. split.py</h2>
<p>linziListに燐字の表を打ち込む。これが一番疲れた。どういう対応かは画像とファイル見て察してほしい。</p>
<p>split.pyを走らせる。</p>
<pre>ValueError: zero-size array to reduction operation maximum which has no identity</pre>
<p>おおっと。</p>
<p>存在しない画像範囲にアクセスして死んでるらしいが、出力画像を見てみるとたしかに途中で変に折り返されている。</p>
<p>訊くと、foo()内でsave()に渡す整数が何文字で折り返すか決めるらしい。今回は1枚目に10、2枚目に8を設定。</p>
<p>次はsave()を見る。Bのところの数字二つが縦と横のピクセル数を示すそうだ。試行錯誤を繰り返した末、今回は縦64、横66で行く。</p>
<p>1枚目でやってみると動いて2枚目突入したところで同じエラーはいて止まった。とりあえずこれで動くのはわかった。</p>
<br>
<h2>3. 完成</h2>
<p>2枚目の原稿でも1と2を繰り返して、最後まで動かしてディレクトリ整理。</p>
<p>便宜的に作っていたフォルダから文字画像を全部取り出して画像ルートに並べておわり。</p>
<p>コードにもコメントをつけておいたのでこれと一緒に読んだらまぁ分かると思う。</p>

</body>
